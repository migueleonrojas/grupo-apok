<section class="card-item-container">
  @if ((nodes$ | async) == undefined) {
  <mat-card class="card-item" appearance="outlined">
    <mat-card-content>
      <span class="text-center">NO HAY MÁS NODOS HIJOS</span>
    </mat-card-content>
    <mat-card-footer class="card-item-options">
      <button
        mat-fab
        aria-label="go back"
        matTooltip="Regresar"
        (click)="goBack()"
      >
        <mat-icon>arrow_back</mat-icon>
      </button>
    </mat-card-footer>
  </mat-card>
  } @else {
  <mat-card class="card-item-new" appearance="outlined">
    <mat-card-header>
      <mat-card-title> Crear otro nodo </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <h4>Selecciona varios lenguajes</h4>
      <mat-form-field>
        <mat-label>Lenguajes</mat-label>
        <mat-select [formControl]="locales" multiple>
          @for (locale of (locales$ | async); track $index) {
          <mat-option [value]="locale">{{ locale.label }}</mat-option>
          }
        </mat-select>
      </mat-form-field>
    </mat-card-content>
    <mat-card-footer class="card-item-new-options">
      <mat-chip color="primary" (click)="createNode()">Crear Nodo</mat-chip>
    </mat-card-footer>
  </mat-card>
  @defer (when (nodes$ | async)) { @for (node of (nodes$ | async); track $index)
  {

  <mat-card class="card-item" appearance="outlined">
    <mat-card-header>
      <mat-card-title>
        <div>
          <span><b>Id:</b></span> {{ node.id }}
        </div>
        <div>
          <span><b>Título:</b></span> {{ node.title }}
        </div>
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <h4>Selecciona un lenguaje</h4>
      <mat-form-field>
        <mat-label>Lenguajes</mat-label>
        <mat-select (selectionChange)="changeLocale($event, node)">
          @for (locale of (locales$ | async); track $index) {
          <mat-option [value]="locale">{{ locale.label }}</mat-option>
          }
        </mat-select>
      </mat-form-field>
    </mat-card-content>

    <mat-card-footer class="card-item-options">
      <mat-chip-set aria-label="options">
        <mat-chip color="primary" (click)="deleteNode(node.id)"
          >Eliminar Nodo</mat-chip
        >
        <mat-chip (click)="goToParentNode(node.parent!)"
          >Ver Nodo Padre</mat-chip
        >
        <mat-chip (click)="goToChildNode(node.id)">Ir al Nodo Hijo</mat-chip>
      </mat-chip-set>
    </mat-card-footer>
  </mat-card>

  } } @placeholder {
  <h2 class="text">Cargando</h2>
  } @error {
  <h2>Hubo un error al obtener los nodos</h2>
  } }
</section>
